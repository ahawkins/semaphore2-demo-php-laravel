version: v1.0
name: PHP Example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Warm cache
    task:
      prologue:
        commands:
          - checkout
      jobs:
        - name: Dependencies
          commands:
            - cache restore v1-composer-$(checksum composer.lock)
            - composer install
            - cache store v1-composer-$(checksum composer.lock) vendor
  - name: Test
    task:
      prologue:
        commands:
          - checkout
          - cache restore v1-composer-$(checksum composer.lock)
          - export PATH="./vendor/bin:${PATH}"
      jobs:
        - name: Everything
          commands:
            - touch storage/testing.sqlite
            - php artisan migrate
            - codecept build
            - codecept run

